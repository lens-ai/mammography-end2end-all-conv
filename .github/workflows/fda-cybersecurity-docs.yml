# ðŸ¥ FDA Cybersecurity Documentation Generator - Client Workflow
# Copy this file to .github/workflows/fda-docs.yml in your repository
# Then add required secrets to your repository settings

name: ðŸ¥ Generate FDA Documentation

on:
  workflow_dispatch:
    inputs:
      device_name:
        description: 'Your Medical Device Name'
        required: true
        default: 'My Medical Device'
      device_manufacturer:
        description: 'Your Company Name'
        required: true
        default: 'My Company'
      device_version:
        description: 'Software Version'
        required: false
        default: '1.0.0'
      output_format:
        description: 'Documentation Scope'
        required: false
        default: 'full'
        type: choice
        options:
          - full
          - incremental

jobs:
  generate-fda-docs:
    name: ðŸ¥ Generate FDA Documents
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“‹ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ðŸ¥ Generate FDA Documentation
      uses: lens-ai/lensai-fda-cybersecurity@v1
      with:
        # Required inputs
        baseten_api_key: ${{ secrets.BASETEN_API_KEY }}
        device_name: ${{ github.event.inputs.device_name }}
        device_manufacturer: ${{ github.event.inputs.device_manufacturer }}
        device_version: ${{ github.event.inputs.device_version }}
        github_token: ${{ secrets.GITHUB_TOKEN }}
        target_repository: ${{ github.repository }}
        output_format: ${{ github.event.inputs.output_format }}
        
        # Optional Atlassian Integration (uncomment if you use Jira/Confluence)
        # jira_url: ${{ secrets.JIRA_URL }}
        # jira_email: ${{ secrets.JIRA_EMAIL }}
        # jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
        # jira_project_key: ${{ secrets.JIRA_PROJECT_KEY }}
        # confluence_url: ${{ secrets.CONFLUENCE_URL }}
        # confluence_email: ${{ secrets.CONFLUENCE_EMAIL }}
        # confluence_api_token: ${{ secrets.CONFLUENCE_API_TOKEN }}
        # confluence_space_key: ${{ secrets.CONFLUENCE_SPACE_KEY }}
    
    - name: ðŸ“Š Upload FDA Documents
      uses: actions/upload-artifact@v4
      with:
        name: fda-cybersecurity-docs-${{ github.run_id }}
        path: ./fda-output/
        retention-days: 30
        if-no-files-found: error
    
    - name: ðŸ“‹ Summary
      run: |
        echo "## ðŸ¥ FDA Documentation Generated" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Success!" >> $GITHUB_STEP_SUMMARY
        echo "- **Device**: ${{ github.event.inputs.device_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Manufacturer**: ${{ github.event.inputs.device_manufacturer }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Version**: ${{ github.event.inputs.device_version }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Format**: ${{ github.event.inputs.output_format }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Documents**: $(find ./fda-output -name "*.md" -type f | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“„ Generated Files:" >> $GITHUB_STEP_SUMMARY
        find ./fda-output -name "*.md" -type f -exec basename {} \; | sort | sed 's/^/- âœ… /' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Download the artifacts above to get your FDA cybersecurity documentation!" >> $GITHUB_STEP_SUMMARY
